@startuml c4_class
allowmixing
skinparam linetype ortho
title C4 - Code Level Diagram (–§–ê–õ–¢.–∫–æ–Ω—Ñ)

package usecases {
    note as usecases_description
        –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
        Use Cases –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å –¥–æ–º–µ–Ω–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ –∏–∑ —Å–ª–æ—è Entities.
    end note

    ' –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π use case
    abstract class AbstractUseCase {
        + execute(*args, **kwargs) : Any
    }

    ' Use case –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–Ω–∏—è
    class CreateConfessionUseCase {
        - _confession_repository: ConfessionRepositoryProtocol
        + __init__(confession_repository: ConfessionRepositoryProtocol) : None
        + execute(confession_dto: ConfessionDTO) : None
    }
    note bottom of CreateConfessionUseCase
        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç Confession
        —Å –≤–ª–æ–∂–µ–Ω–∏—è–º–∏ –∏ —Ç–µ–≥–∞–º–∏ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ —á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
    end note

    ' Use case –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–∑–Ω–∞–Ω–∏—è
    class ModerateConfessionUseCase {
        - _moderation_gateway: ModerationGatewayProtocol
        - _confession_repository: ConfessionRepositoryProtocol
        + __init__(moderation_gateway: ModerationGatewayProtocol, confession_repository: ConfessionRepositoryProtocol) : None
        + execute(confession_dto: ConfessionDTO) : bool
    }
    note bottom of ModerateConfessionUseCase
        –ü—Ä–æ–≤–æ–¥–∏—Ç –º–æ–¥–µ—Ä–∞—Ü–∏—é –ø—Ä–∏–∑–Ω–∞–Ω–∏—è, –æ–±–Ω–æ–≤–ª—è—è –µ–≥–æ —Å—Ç–∞—Ç—É—Å (PENDING, APPROVED, REJECTED)
        —Å –ø–æ–º–æ—â—å—é LLM –∏–ª–∏ —Ä—É—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è.
    end note

    ' Use case –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏–∑–Ω–∞–Ω–∏—è –≤ Telegram
    class PublishConfessionUseCase {
        - _telegram_gateway: TelegramGatewayProtocol
        - _confession_repository: ConfessionRepositoryProtocol
        + __init__(telegram_gateway: TelegramGatewayProtocol, confession_repository: ConfessionRepositoryProtocol) : None
        + execute(confession_dto: ConfessionDTO) : None
    }
    note bottom of PublishConfessionUseCase
        –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–Ω–æ–µ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –≤ Telegram-–∫–∞–Ω–∞–ª —á–µ—Ä–µ–∑ TelegramGateway.
        –ï—Å–ª–∏ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç –æ–ø—Ä–æ—Å, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è send_poll, –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π poll_message_id —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.
    end note

    ' Use case –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–π
    class UpdateReactionsUseCase {
        - _telegram_gateway: TelegramGatewayProtocol
        - _reaction_repository: ReactionRepositoryProtocol
        + __init__(telegram_gateway: TelegramGatewayProtocol, reaction_repository: ReactionRepositoryProtocol) : None
        + execute() : None
    }
    note bottom of UpdateReactionsUseCase
        –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç Telegram API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ —Ä–µ–∞–∫—Ü–∏—è—Ö
        –∫ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–º –ø—Ä–∏–∑–Ω–∞–Ω–∏—è–º –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
    end note

    AbstractUseCase <|-- CreateConfessionUseCase
    AbstractUseCase <|-- ModerateConfessionUseCase
    AbstractUseCase <|-- PublishConfessionUseCase
    AbstractUseCase <|-- UpdateReactionsUseCase
}

' –ü—Ä–∏–º–µ—Ä—ã –≤–∑–∞–∏–º–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–π –º–µ–∂–¥—É –∫–ª–∞—Å—Å–∞–º–∏:
CreateConfessionUseCase *-- "1" ConfessionRepositoryProtocol : _confession_repository
PublishConfessionUseCase *-- "1" ConfessionRepositoryProtocol : _confession_repository
ModerateConfessionUseCase *-- "1" ModerationGatewayProtocol : _moderation_gateway
UpdateReactionsUseCase o-- "1" ReactionRepositoryProtocol : _reaction_repository
UpdateReactionsUseCase o-- "1" TelegramGatewayProtocol : _telegram_gateway





package entities {
    note as entities_description
        –ú–æ–¥–µ–ª—å –¥–æ–º–µ–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –¥–ª—è –§–ê–õ–¢.–∫–æ–Ω—Ñ.
    end note

    enum ConfessionStatus {
        PENDING
        APPROVED
        REJECTED
        PUBLISHED
    }

    enum AttachmentType {
        IMAGE
        VIDEO
        AUDIO
        MUSIC
        DOCUMENT
        OTHER
    }

    class Confession {
        + id: int
        + content: string
        + created_at: datetime
        + status: ConfessionStatus
        + attachments: List<Attachment>
        + tags: List<Tag>
        + poll: Poll [0..1]           ' –°–≤—è–∑—å —Å –æ–ø—Ä–æ—Å–æ–º, –µ—Å–ª–∏ –æ–Ω —Å–æ–∑–¥–∞–Ω
    }

    class Attachment {
        + id: int
        + url: string
        + type: AttachmentType
        + uploaded_at: datetime
        + caption: string [0..1]
    }

    ' –°—É—â–Ω–æ—Å—Ç—å –æ–ø—Ä–æ—Å–∞
    class Poll {
        + id: int
        + question: string              ' –¢–µ–º–∞ –æ–ø—Ä–æ—Å–∞ (–≤–æ–ø—Ä–æ—Å)
        + allows_multiple_answers: bool ' –†–∞–∑—Ä–µ—à–µ–Ω –ª–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä
        + type: string                  ' –¢–∏–ø –æ–ø—Ä–æ—Å–∞: "regular" –∏–ª–∏ "quiz"
        + correct_option_id: int [0..1]  ' (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è quiz —Ä–µ–∂–∏–º–∞
        + explanation: string [0..1]     ' (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ø–æ—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è quiz —Ä–µ–∂–∏–º–∞
        + open_period: int [0..1]        ' (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ø–µ—Ä–∏–æ–¥ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö, –≤ —Ç–µ—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –æ–ø—Ä–æ—Å –æ—Ç–∫—Ä—ã—Ç
        + poll_message_id: string [0..1] ' ID —Å–æ–æ–±—â–µ–Ω–∏—è —Å –æ–ø—Ä–æ—Å–æ–º, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —á–µ—Ä–µ–∑ Telegram API
        + created_at: datetime
        + options: List<PollOption>
    }

    class PollOption {
        + id: int
        + text: string
        + vote_count: int
    }

    class ModerationLog {
        + id: int
        + confession_id: int
        + decision: ConfessionStatus
        + moderator: string
        + reason: string [0..1]
        + timestamp: datetime
    }

    class PublishedRecord {
        + id: int
        + confession_id: int
        + telegram_message_id: string
        + channel_id: string
        + published_at: datetime
        + discussion_thread_id: string [0..1]
    }

    class Tag {
        + id: int
        + name: string
    }

    class Comment {
        + id: int
        + confession_id: int
        + content: string
        + created_at: datetime
        + reply_to: int [0..1] ' ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
    }

    ' –ù–æ–≤–∞—è —Å—É—â–Ω–æ—Å—Ç—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–π
    class Reaction {
        + id: int
        + confession_id: int
        + emoji: string        ' –°–∏–º–≤–æ–ª —Ä–µ–∞–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "üëç")
        + count: int           ' –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ä–µ–∞–∫—Ü–∏–π –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞
        + last_updated: datetime ' –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–∞–∫—Ü–∏–∏
    }

    ' –ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏:
    Confession "0..1" --> "1..*" Attachment : —Å–æ–¥–µ—Ä–∂–∏—Ç
    Confession "1" --> "0..*" ModerationLog : –∏–º–µ–µ—Ç
    Confession "1" --> "0..1" PublishedRecord : –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è
    Confession "1" --> "0..*" Tag : –ø–æ–º–µ—á–∞–µ—Ç—Å—è
    Confession "1" --> "0..*" Comment : –∏–º–µ–µ—Ç
    Confession "0..1" --> "0..1" Poll : –≤–∫–ª—é—á–∞–µ—Ç
    Poll "1" --> "1..*" PollOption : —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã

    ' –°–≤—è–∑—å –¥–ª—è —Ä–µ–∞–∫—Ü–∏–∏: –æ–¥–Ω–æ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –º–Ω–æ–≥–æ —Ä–µ–∞–∫—Ü–∏–π —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤
    Confession "1" --> "0..*" Reaction : –∏–º–µ–µ—Ç
}

' –£—Ä–æ–≤–Ω–µ–≤—ã–µ —Å–≤—è–∑–∏: Use Cases –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–æ–º–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏–∑ —Å–ª–æ—è Entities
usecases -down----> entities : –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–æ–º–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã

@enduml